calc_accuracy <- function(d) {
participant <- d$participant[1]
trial <- d$trial_count[1]
thinnest_lines_set <- thinnest_lines[thinnest_lines$participant == participant & thinnest_lines$trial_count == trial,]$line_id
## determine the final three lines they selected
selected_lines <- c(NA, NA, NA)
for (row in 1:(nrow(d))) {
if (d[row,]$selected_or_released == 'selected') {
selected_lines[which(is.na(selected_lines))[1]] <- d[row,]$line_id
} else {
selected_lines[!(is.na(selected_lines)) & selected_lines == d[row,]$line_id] <- NA
}
}
print(selected_lines)
assert(length(selected_lines) == 3)
hits <- sum(selected_lines %in% thinnest_lines_set)
false_alarms <- length(selected_lines) - hits
misses <- sum(!(thinnest_lines_set %in% selected_lines))
return(c(hits, false_alarms, misses))
}
# d %>%
#   filter(participant == 90, trial_count == 2) %>%
#   group_by(participant, trial_count) %>%
#   summarize(hits = calc_accuracy(., output = 'hits'), misses = calc_accuracy(., output = 'misses'), false_alarms = calc_accuracy(., output = 'false_alarms'), accuracy = mean(accuracy, na.rm = TRUE)) %>%
#   head()
new_d <- data.frame(participant = vector(), trial_count = vector(), hits = vector(), false_alarms = vector(), misses = vector(), accuracy = vector())
for (participant in unlist(lapply(levels(factor(d$participant)), as.integer))) {
for (trial in 1:99) {
in_data <- d[d$participant == participant & d$trial_count == trial,]
output = calc_accuracy(in_data)
new_d <- rbind(new_d, c(participant, trial, output[1], output[2], output[3], in_data$accuracy[nrow(in_data)]))
}
}
calc_accuracy <- function(d) {
participant <- d$participant[1]
trial <- d$trial_count[1]
thinnest_lines_set <- thinnest_lines[thinnest_lines$participant == participant & thinnest_lines$trial_count == trial,]$line_id
## determine the final three lines they selected
selected_lines <- c(NA, NA, NA)
for (row in 1:(nrow(d))) {
if (d[row,]$selected_or_released == 'selected') {
selected_lines[which(is.na(selected_lines))[1]] <- d[row,]$line_id
} else {
selected_lines[!(is.na(selected_lines)) & selected_lines == d[row,]$line_id] <- NA
}
}
assert(length(selected_lines) == 3)
hits <- sum(selected_lines %in% thinnest_lines_set)
false_alarms <- length(selected_lines) - hits
misses <- sum(!(thinnest_lines_set %in% selected_lines))
return(c(hits, false_alarms, misses))
}
# d %>%
#   filter(participant == 90, trial_count == 2) %>%
#   group_by(participant, trial_count) %>%
#   summarize(hits = calc_accuracy(., output = 'hits'), misses = calc_accuracy(., output = 'misses'), false_alarms = calc_accuracy(., output = 'false_alarms'), accuracy = mean(accuracy, na.rm = TRUE)) %>%
#   head()
new_d <- data.frame(participant = vector(), trial_count = vector(), hits = vector(), false_alarms = vector(), misses = vector(), accuracy = vector())
for (participant in unlist(lapply(levels(factor(d$participant)), as.integer))) {
for (trial in 1:99) {
in_data <- d[d$participant == participant & d$trial_count == trial,]
output = calc_accuracy(in_data)
new_d <- rbind(new_d, c(participant, trial, output[1], output[2], output[3], in_data$accuracy[nrow(in_data)]))
}
}
new_d
new_d <- data.frame(participant = vector(), trial_count = vector(), hits = vector(), false_alarms = vector(), misses = vector(), accuracy = vector())
new_d
calc_accuracy <- function(d) {
participant <- d$participant[1]
trial <- d$trial_count[1]
thinnest_lines_set <- thinnest_lines[thinnest_lines$participant == participant & thinnest_lines$trial_count == trial,]$line_id
## determine the final three lines they selected
selected_lines <- c(NA, NA, NA)
for (row in 1:(nrow(d))) {
if (d[row,]$selected_or_released == 'selected') {
selected_lines[which(is.na(selected_lines))[1]] <- d[row,]$line_id
} else {
selected_lines[!(is.na(selected_lines)) & selected_lines == d[row,]$line_id] <- NA
}
}
assert(length(selected_lines) == 3)
hits <- sum(selected_lines %in% thinnest_lines_set)
false_alarms <- length(selected_lines) - hits
misses <- sum(!(thinnest_lines_set %in% selected_lines))
return(c(hits, false_alarms, misses))
}
# d %>%
#   filter(participant == 90, trial_count == 2) %>%
#   group_by(participant, trial_count) %>%
#   summarize(hits = calc_accuracy(., output = 'hits'), misses = calc_accuracy(., output = 'misses'), false_alarms = calc_accuracy(., output = 'false_alarms'), accuracy = mean(accuracy, na.rm = TRUE)) %>%
#   head()
new_d <- data.frame(participant = vector(), trial_count = vector(), hits = vector(), false_alarms = vector(), misses = vector(), accuracy = vector())
for (participant in unlist(lapply(levels(factor(d$participant)), as.integer))) {
for (trial in 1:99) {
in_data <- d[d$participant == participant & d$trial_count == trial,]
output = calc_accuracy(in_data)
new_d <- rbind(new_d, data.frame(participant = participant, trial_count = trial, hits = output[1], false_alarms = output[2], misses = output[3], accuracy = in_data$accuracy[nrow(in_data)]))
}
}
new_d
head(d)
calc_accuracy_columns <- function(d) {
participant <- d$participant[1]
trial <- d$trial_count[1]
thinnest_lines_set <- thinnest_lines[thinnest_lines$participant == participant & thinnest_lines$trial_count == trial,]$line_id
## determine the final three lines they selected
selected_lines <- c(NA, NA, NA)
for (row in 1:(nrow(d))) {
if (d[row,]$selected_or_released == 'selected') {
selected_lines[which(is.na(selected_lines))[1]] <- d[row,]$line_id
} else {
selected_lines[!(is.na(selected_lines)) & selected_lines == d[row,]$line_id] <- NA
}
}
selected_lines_accuracy_column <- ifelse(d$line_id %in% selected_lines & d$line_id %in% thinnest_lines_set, 'hit', 'false_alarm')
return(selected_lines_accuracy_column)
}
# d %>%
#   filter(participant == 90, trial_count == 2) %>%
#   group_by(participant, trial_count) %>%
#   summarize(hits = calc_accuracy(., output = 'hits'), misses = calc_accuracy(., output = 'misses'), false_alarms = calc_accuracy(., output = 'false_alarms'), accuracy = mean(accuracy, na.rm = TRUE)) %>%
#   head()
#new_d <- data.frame(participant = vector(), trial_count = vector(), hits = vector(), false_alarms = vector(), misses = vector(), accuracy = vector())
out  <- vector()
for (participant in unlist(lapply(levels(factor(d$participant)), as.integer))) {
for (trial in 1:99) {
new_col <- c(out, calc_accuracy_columns(d[d$participant == participant & d$trial_count == trial,]))
}
}
length(new_col) == nrow(d)
length(new_col)
new_col
calc_accuracy_columns <- function(d) {
participant <- d$participant[1]
trial <- d$trial_count[1]
thinnest_lines_set <- thinnest_lines[thinnest_lines$participant == participant & thinnest_lines$trial_count == trial,]$line_id
## determine the final three lines they selected
selected_lines <- c(NA, NA, NA)
for (row in 1:(nrow(d))) {
if (d[row,]$selected_or_released == 'selected') {
selected_lines[which(is.na(selected_lines))[1]] <- d[row,]$line_id
} else {
selected_lines[!(is.na(selected_lines)) & selected_lines == d[row,]$line_id] <- NA
}
}
selected_lines_accuracy_column <- ifelse(d$line_id %in% selected_lines & d$line_id %in% thinnest_lines_set, 'hit', 'false_alarm')
return(selected_lines_accuracy_column)
}
# d %>%
#   filter(participant == 90, trial_count == 2) %>%
#   group_by(participant, trial_count) %>%
#   summarize(hits = calc_accuracy(., output = 'hits'), misses = calc_accuracy(., output = 'misses'), false_alarms = calc_accuracy(., output = 'false_alarms'), accuracy = mean(accuracy, na.rm = TRUE)) %>%
#   head()
#new_d <- data.frame(participant = vector(), trial_count = vector(), hits = vector(), false_alarms = vector(), misses = vector(), accuracy = vector())
out  <- vector()
for (participant in unlist(lapply(levels(factor(d$participant)), as.integer))) {
for (trial in 1:99) {
out <- c(out, calc_accuracy_columns(d[d$participant == participant & d$trial_count == trial,]))
}
}
length(new_col) == nrow(d)
length(new_col)
new_col
length(out) == nrow(d)
length(out)
nrow(d)
length(out)
head(d)
calc_accuracy_columns <- function(d) {
participant <- d$participant[1]
trial <- d$trial_count[1]
thinnest_lines_set <- thinnest_lines[thinnest_lines$participant == participant & thinnest_lines$trial_count == trial,]$line_id
## determine the final three lines they selected
selected_lines <- c(NA, NA, NA)
for (row in 1:(nrow(d))) {
if (d[row,]$selected_or_released == 'selected') {
selected_lines[which(is.na(selected_lines))[1]] <- d[row,]$line_id
} else {
selected_lines[!(is.na(selected_lines)) & selected_lines == d[row,]$line_id] <- NA
}
}
selected_lines_accuracy_column <- ifelse(is.na(line_id), NA, ifelse(d$line_id %in% selected_lines & d$line_id %in% thinnest_lines_set, 'hit', 'false_alarm'))
return(selected_lines_accuracy_column)
}
# d %>%
#   filter(participant == 90, trial_count == 2) %>%
#   group_by(participant, trial_count) %>%
#   summarize(hits = calc_accuracy(., output = 'hits'), misses = calc_accuracy(., output = 'misses'), false_alarms = calc_accuracy(., output = 'false_alarms'), accuracy = mean(accuracy, na.rm = TRUE)) %>%
#   head()
#new_d <- data.frame(participant = vector(), trial_count = vector(), hits = vector(), false_alarms = vector(), misses = vector(), accuracy = vector())
out  <- vector()
for (participant in unlist(lapply(levels(factor(d$participant)), as.integer))) {
for (trial in 1:99) {
out <- c(out, calc_accuracy_columns(d[d$participant == participant & d$trial_count == trial,]))
}
}
calc_accuracy_columns <- function(d) {
participant <- d$participant[1]
trial <- d$trial_count[1]
thinnest_lines_set <- thinnest_lines[thinnest_lines$participant == participant & thinnest_lines$trial_count == trial,]$line_id
## determine the final three lines they selected
selected_lines <- c(NA, NA, NA)
for (row in 1:(nrow(d))) {
if (d[row,]$selected_or_released == 'selected') {
selected_lines[which(is.na(selected_lines))[1]] <- d[row,]$line_id
} else {
selected_lines[!(is.na(selected_lines)) & selected_lines == d[row,]$line_id] <- NA
}
}
selected_lines_accuracy_column <- ifelse(is.na(d$line_id), NA, ifelse(d$line_id %in% selected_lines & d$line_id %in% thinnest_lines_set, 'hit', 'false_alarm'))
return(selected_lines_accuracy_column)
}
# d %>%
#   filter(participant == 90, trial_count == 2) %>%
#   group_by(participant, trial_count) %>%
#   summarize(hits = calc_accuracy(., output = 'hits'), misses = calc_accuracy(., output = 'misses'), false_alarms = calc_accuracy(., output = 'false_alarms'), accuracy = mean(accuracy, na.rm = TRUE)) %>%
#   head()
#new_d <- data.frame(participant = vector(), trial_count = vector(), hits = vector(), false_alarms = vector(), misses = vector(), accuracy = vector())
out  <- vector()
for (participant in unlist(lapply(levels(factor(d$participant)), as.integer))) {
for (trial in 1:99) {
out <- c(out, calc_accuracy_columns(d[d$participant == participant & d$trial_count == trial,]))
}
}
length(out) == nrow(d)
length(out)
nrow(d)
sum(is.na(out) )
(nrow(d) - length(out)) == nrow(d[d$pressed_object == 'submit',])
nrow(d[d$pressed_object == 'submit',])
max(d$trial_count)
out[1]
d[1]
head(d)
head(out)
calc_accuracy_columns <- function(d) {
participant <- d$participant[1]
trial <- d$trial_count[1]
thinnest_lines_set <- thinnest_lines[thinnest_lines$participant == participant & thinnest_lines$trial_count == trial,]$line_id
## determine the final three lines they selected
selected_lines <- c(NA, NA, NA)
for (row in 1:(nrow(d))) {
if (d[row,]$selected_or_released == 'selected') {
selected_lines[which(is.na(selected_lines))[1]] <- d[row,]$line_id
} else {
selected_lines[!(is.na(selected_lines)) & selected_lines == d[row,]$line_id] <- NA
}
}
selected_lines_accuracy_column <- ifelse(is.na(d$bottom_y), NA, ifelse(d$line_id %in% selected_lines & d$line_id %in% thinnest_lines_set, 'hit', 'false_alarm'))
return(selected_lines_accuracy_column)
}
# d %>%
#   filter(participant == 90, trial_count == 2) %>%
#   group_by(participant, trial_count) %>%
#   summarize(hits = calc_accuracy(., output = 'hits'), misses = calc_accuracy(., output = 'misses'), false_alarms = calc_accuracy(., output = 'false_alarms'), accuracy = mean(accuracy, na.rm = TRUE)) %>%
#   head()
#new_d <- data.frame(participant = vector(), trial_count = vector(), hits = vector(), false_alarms = vector(), misses = vector(), accuracy = vector())
out  <- vector()
for (participant in unlist(lapply(levels(factor(d$participant)), as.integer))) {
for (trial in 1:99) {
out <- c(out, calc_accuracy_columns(d[d$participant == participant & d$trial_count == trial,]))
}
}
nrow(d[d$pressed_object == 'submit',])
head(out)
length(out)
nrow(d)
participants <- unlist(lapply(levels(factor(d$participant)), as.integer))
participants
calc_accuracy_columns <- function(d) {
participant <- d$participant[1]
trial <- d$trial_count[1]
thinnest_lines_set <- thinnest_lines[thinnest_lines$participant == participant & thinnest_lines$trial_count == trial,]$line_id
## determine the final three lines they selected
selected_lines <- c(NA, NA, NA)
for (row in 1:(nrow(d))) {
if (d[row,]$selected_or_released == 'selected') {
selected_lines[which(is.na(selected_lines))[1]] <- d[row,]$line_id
} else {
selected_lines[!(is.na(selected_lines)) & selected_lines == d[row,]$line_id] <- NA
}
}
selected_lines_accuracy_column <- ifelse(is.na(d$bottom_y), NA, ifelse(d$line_id %in% selected_lines & d$line_id %in% thinnest_lines_set, 'hit', 'false_alarm'))
return(selected_lines_accuracy_column)
}
# d %>%
#   filter(participant == 90, trial_count == 2) %>%
#   group_by(participant, trial_count) %>%
#   summarize(hits = calc_accuracy(., output = 'hits'), misses = calc_accuracy(., output = 'misses'), false_alarms = calc_accuracy(., output = 'false_alarms'), accuracy = mean(accuracy, na.rm = TRUE)) %>%
#   head()
#new_d <- data.frame(participant = vector(), trial_count = vector(), hits = vector(), false_alarms = vector(), misses = vector(), accuracy = vector())
out  <- vector()
for (participant in unlist(lapply(levels(factor(d$participant)), as.integer))) {
for (trial in 0:99) {
out <- c(out, calc_accuracy_columns(d[d$participant == participant & d$trial_count == trial,]))
}
}
nrow(d) == length(out)
d %>%
filter(pressed_object == 'submit') %>%
select(participant, trial_count, accuracy) %>%
inner_join(thinnest_lines)
thinnest_lines <- d %>%
filter(pressed_object == 'submit') %>%
select(participant, trial_count, accuracy) %>%
inner_join(thinnest_lines)
head(thinnest_lines)
library(tidyverse)
library(testit)
d <- read.csv('../../data/raw/long_data/pilot/pilot_data.csv')
thinnest_lines <- read.csv('../../data/raw/line_data/pilot/thinnest_lines.csv')
head(d)
new_d
calc_accuracy_columns <- function(d) {
participant <- d$participant[1]
trial <- d$trial_count[1]
thinnest_lines_set <- thinnest_lines[thinnest_lines$participant == participant & thinnest_lines$trial_count == trial,]$line_id
## determine the final three lines they selected
selected_lines <- c(NA, NA, NA)
for (row in 1:(nrow(d))) {
if (d[row,]$selected_or_released == 'selected') {
selected_lines[which(is.na(selected_lines))[1]] <- d[row,]$line_id
} else {
selected_lines[!(is.na(selected_lines)) & selected_lines == d[row,]$line_id] <- NA
}
}
selected_lines_accuracy_column <- ifelse(is.na(d$bottom_y), NA, ifelse(d$line_id %in% selected_lines & d$line_id %in% thinnest_lines_set, 'hit', 'false_alarm'))
return(selected_lines_accuracy_column)
}
out  <- vector()
for (participant in unlist(lapply(levels(factor(d$participant)), as.integer))) {
for (trial in 0:99) {
out <- c(out, calc_accuracy_columns(d[d$participant == participant & d$trial_count == trial,]))
}
}
d$accuracy_type <- out
thinnest_lines <- d %>%
filter(pressed_object == 'submit') %>%
select(participant, trial_count, accuracy) %>%
inner_join(thinnest_lines)
head(thinnest_lines)
## summarize hits and false alarms
head(d)
## summarize hits and false alarms
d %>%
filter(!(is.na(accuracy_type))) %>%
spread(accuracy) %>%
head()
## summarize hits and false alarms
d %>%
filter(!(is.na(accuracy_type))) %>%
spread(accuracy) %>%
head(.)
## summarize hits and false alarms
d %>%
filter(!(is.na(accuracy_type))) %>%
spread(accuracy_type) %>%
head(.)
## summarize hits and false alarms
d %>%
filter(!(is.na(accuracy_type))) %>%
head()
## summarize hits and false alarms
d %>%
filter(!(is.na(accuracy_type))) %>%
mutate(hit = ifelse(accuracy_type == 'hit', 1, 0), false_alarm = ifelse(accuracy_type == 'false_alarm', 1, 0)) %>%
head()
## summarize hits and false alarms
d %>%
filter(!(is.na(accuracy_type))) %>%
mutate(hit = ifelse(accuracy_type == 'hit', 1, 0), false_alarm = ifelse(accuracy_type == 'false_alarm', 1, 0)) %>%
group_by(line_orientation) %>%
summarize(hits = sum(hit), false_alarms = sum(false_alarm))
## summarize misses
thinnest_lines <- d %>%
filter(pressed_object == 'submit') %>%
select(participant, trial_count, accuracy) %>%
inner_join(thinnest_lines)
head(thinnest_lines)
thinnest_lines %>%
filter(accuracy != 1) %>%
group_by(line_orientation) %>%
summarize(misses = n())
## summarize misses
thinnest_lines <- d %>%
filter(pressed_object == 'submit') %>%
select(participant, trial_count, accuracy) %>%
inner_join(thinnest_lines)
thinnest_lines %>%
filter(accuracy != 1) %>%
group_by(line_orientation) %>%
summarize(misses = n()) %>%
inner_join(summary_data)
## summarize hits and false alarms
summary_data <- d %>%
filter(!(is.na(accuracy_type))) %>%
mutate(hit = ifelse(accuracy_type == 'hit', 1, 0), false_alarm = ifelse(accuracy_type == 'false_alarm', 1, 0)) %>%
group_by(line_orientation) %>%
summarize(hits = sum(hit), false_alarms = sum(false_alarm))
## summarize misses
thinnest_lines <- d %>%
filter(pressed_object == 'submit') %>%
select(participant, trial_count, accuracy) %>%
inner_join(thinnest_lines)
thinnest_lines %>%
filter(accuracy != 1) %>%
group_by(line_orientation) %>%
summarize(misses = n()) %>%
inner_join(summary_data)
thinnest_lines %>%
filter(accuracy != 1) %>%
group_by(line_orientation) %>%
summarize(misses = n()) %>%
inner_join(summary_data) %>%
gather(accuracy_type, count, misses:false_alarms)
summary_data %>%
ggplot(aes(x = line_orientation, y = count)) %>%
geom_bar(stat = 'identity', aes(fill = accuracy_type), position = position_dodge(width = .9))
## summarize misses
thinnest_lines <- d %>%
filter(pressed_object == 'submit') %>%
select(participant, trial_count, accuracy) %>%
inner_join(thinnest_lines)
summary_data <- thinnest_lines %>%
filter(accuracy != 1) %>%
group_by(line_orientation) %>%
summarize(misses = n()) %>%
inner_join(summary_data) %>%
gather(accuracy_type, count, misses:false_alarms)
summary_data %>%
ggplot(aes(x = line_orientation, y = count)) +
geom_bar(stat = 'identity', aes(fill = accuracy_type), position = position_dodge(width = .9))
summary_data %>%
ggplot(aes(x = line_orientation, y = count)) +
geom_bar(stat = 'identity', aes(fill = accuracy_type), position = position_dodge(width = .9)) +
labs(
y = 'Count',
x = 'Line Orientation',
fill = 'Accuracy Type'
) +
theme_bw()
ggsave('line_orientation.png', height = 1080 / 300, width = 1920 / 300, units = 'px', dpi = 300)
ggsave('line_orientation.png', height = 1080 / 300, width = 1920 / 300, units = 'in', dpi = 300)
## summarize misses
thinnest_lines <- d %>%
filter(pressed_object == 'submit') %>%
select(participant, trial_count, accuracy) %>%
inner_join(thinnest_lines)
summary_data <- thinnest_lines %>%
filter(accuracy != 1) %>%
group_by(line_orientation) %>%
summarize(misses = n()) %>%
inner_join(summary_data) %>%
gather(accuracy_type, count, misses:false_alarms)
library(tidyverse)
library(testit)
d <- read.csv('../../data/raw/long_data/pilot/pilot_data.csv')
thinnest_lines <- read.csv('../../data/raw/line_data/pilot/thinnest_lines.csv')
head(d)
calc_accuracy_columns <- function(d) {
participant <- d$participant[1]
trial <- d$trial_count[1]
thinnest_lines_set <- thinnest_lines[thinnest_lines$participant == participant & thinnest_lines$trial_count == trial,]$line_id
## determine the final three lines they selected
selected_lines <- c(NA, NA, NA)
for (row in 1:(nrow(d))) {
if (d[row,]$selected_or_released == 'selected') {
selected_lines[which(is.na(selected_lines))[1]] <- d[row,]$line_id
} else {
selected_lines[!(is.na(selected_lines)) & selected_lines == d[row,]$line_id] <- NA
}
}
selected_lines_accuracy_column <- ifelse(is.na(d$bottom_y), NA, ifelse(d$line_id %in% selected_lines & d$line_id %in% thinnest_lines_set, 'hit', 'false_alarm'))
return(selected_lines_accuracy_column)
}
out  <- vector()
for (participant in unlist(lapply(levels(factor(d$participant)), as.integer))) {
for (trial in 0:99) {
out <- c(out, calc_accuracy_columns(d[d$participant == participant & d$trial_count == trial,]))
}
}
d$accuracy_type <- out
## summarize hits and false alarms
summary_data <- d %>%
filter(!(is.na(accuracy_type))) %>%
mutate(hit = ifelse(accuracy_type == 'hit', 1, 0), false_alarm = ifelse(accuracy_type == 'false_alarm', 1, 0)) %>%
group_by(line_orientation) %>%
summarize(hits = sum(hit), false_alarms = sum(false_alarm))
## summarize misses
thinnest_lines <- d %>%
filter(pressed_object == 'submit') %>%
select(participant, trial_count, accuracy) %>%
inner_join(thinnest_lines)
summary_data <- thinnest_lines %>%
filter(accuracy != 1) %>%
group_by(line_orientation) %>%
summarize(misses = n()) %>%
inner_join(summary_data) %>%
gather(accuracy_type, count, misses:false_alarms)
summary_data %>%
ggplot(aes(x = line_orientation, y = count)) +
geom_bar(stat = 'identity', aes(fill = accuracy_type), position = position_dodge(width = .9)) +
labs(
y = 'Count',
x = 'Line Orientation',
fill = 'Accuracy Type'
) +
theme_bw() +
theme(legend.position = 'bottom')
ggsave('line_orientation.png', height = 1080 / 300, width = 1920 / 300, units = 'in', dpi = 300)
q()
